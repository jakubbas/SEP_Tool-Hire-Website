<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="css/productstyles.css" />
	<title>
		Shelton Tool-Hire
	</title>
</head>

<header>

	<a href="/">
		<div class="logo">
			<img src="images/SheltonLogo.jpg" alt="Logo" style="max-width: 100px;">
		</div>
	</a>
	<div class="company-name">
		Shelton Tool-Hire
	</div>

	<div class="search-container">
		<div class="" custom-search-bar>
			<input type="text" class="search-input" placeholder="Enter your search term">
			<button class="search-button" onclick="performSearch()">Search</button>
		</div>
	</div>

</header>

<body>
<div class="main-container">
	<script>
			fetch('/api/products/single')
				.then(response => response.json())
				.then(products => {
					loadProduct(products);
				});

			function loadProduct(data) {
				const productContainer = document.getElementById('product-info-container');
				//const productBox = document.createElement('div');

				const productImage = document.createElement('img');
				productImage.id = "product-image";
				productImage.src = data[0].product_image;
				productContainer.appendChild(productImage);


				const infoBox = document.createElement('div');
				infoBox.id = "product-info";
				const title = document.createElement('h2');
				title.textContent = data[0].product_name;
				const description = document.createElement('p');
				description.textContent = data[0].product_description;

				infoBox.appendChild(title);
				infoBox.appendChild(description);
				productContainer.appendChild(infoBox);


				//productContainer.appendChild(productBox);



			}

            //Existing Reviews






		</script>


	<div id="product-info-container">
	</div>

	<div id="product-costing-container">
		<p>
			Costing
		</p>
	</div>

</div>

<div id="reviews-section">
	<form id="review-form">
		<h2>Leave a Review</h2>

		<textarea id="review_name" name="review_name" rows="1" placeholder="Name" required></textarea>

		<textarea id="review_text" name="review_text" rows="4" placeholder="Write your review" required></textarea>

		<h3>Performance Rating</h3>

		<div class="rating" id="performance-div">
			<input type="radio" id="star5" name="performance" value="1" required />
			<label for="star5" title="5 stars"></label>
			<input type="radio" id="star4" name="performance" value="2" required />
			<label for="star4" title="4 stars"></label>
			<input type="radio" id="star3" name="performance" value="3" required />
			<label for="star3" title="3 stars"></label>
			<input type="radio" id="star2" name="performance" value="4" required />
			<label for="star2" title="2 stars"></label>
			<input type="radio" id="star1" name="performance" value="5" required />
			<label for="star1" title="1 star"></label>
		</div>

		<h3>Customer Service Rating</h3>

		<div class="rating" id="customer-service-div">
			<input type="radio" id="" name="customer_service" value="1" required />
			<label for="star5" title="5 stars"></label>
			<input type="radio" id="star4" name="customer_service" value="2" required />
			<label for="star4" title="4 stars"></label>
			<input type="radio" id="star3" name="customer_service" value="3" required />
			<label for="star3" title="3 stars"></label>
			<input type="radio" id="star2" name="customer_service" value="4" required />
			<label for="star2" title="2 stars"></label>
			<input type="radio" id="star1" name="customer_service" value="5" required />
			<label for="star1" title="1 star"></label>
		</div>


		<h3>Support Service Rating</h3>

		<div class="rating" id="support-service-div">
			<input type="radio" id="star5" name="support_service" value="1" required />
			<label for="star5" title="5 stars"></label>
			<input type="radio" id="star4" name="support_service" value="2" required />
			<label for="star4" title="4 stars"></label>
			<input type="radio" id="star3" name="support_service" value="3" required />
			<label for="star3" title="3 stars"></label>
			<input type="radio" id="star2" name="support_service" value="4" required />
			<label for="star2" title="2 stars"></label>
			<input type="radio" id="star1" name="support_service" value="5" required />
			<label for="star1" title="1 star"></label>
		</div>



		<h3>After Sale Support Rating</h3>

		<div class="rating" id="after-sale-support-div">
			<input type="radio" id="star5" name="after_sale_support" value="1" required />
			<label for="star5" title="5 stars"></label>
			<input type="radio" id="star4" name="after_sale_support" value="2" required />
			<label for="star4" title="4 stars"></label>
			<input type="radio" id="star3" name="after_sale_support" value="3" required />
			<label for="star3" title="3 stars"></label>
			<input type="radio" id="star2" name="after_sale_support" value="4" required />
			<label for="star2" title="2 stars"></label>
			<input type="radio" id="star1" name="after_sale_support" value="5" required />
			<label for="star1" title="1 star"></label>
		</div>

		<button type="submit">Submit Review</button>

	</form>

	<script>
			document.getElementById('review-form').addEventListener('submit', function (event) {
				event.preventDefault();

				//Get form data

				const username = document.getElementById('review_name').value;

				const description = document.getElementById('review_text').value;

				const performanceRadio = document.querySelectorAll('#performance-div input[name="performance"]');
				const performance = Array.from(performanceRadio).find(radio => radio.checked).value;

				const customer_serviceRadio = document.querySelectorAll('#customer-service-div input[name="customer_service"]');
				const customer_service = Array.from(customer_serviceRadio).find(radio => radio.checked).value;

				const support_serviceRadio = document.querySelectorAll('#support-service-div input[name="support_service"]');
				const support_service = Array.from(support_serviceRadio).find(radio => radio.checked).value;

				const after_sale_supportRadio = document.querySelectorAll('#after-sale-support-div input[name="after_sale_support"]');
				const after_sale_support = Array.from(after_sale_supportRadio).find(radio => radio.checked).value;

				const date = new Date().toDateString();

				const reviewData = {
					"key1": username,
					"key2": description,
					"key3": performance,
					"key4": customer_service,
					"key5": support_service,
					"key6": after_sale_support,
					"key7": date
				};

				fetch('/review-submit', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(reviewData)
				})
					.then(response => response.json())
					.then(data => {
						console.log('Server response:', data);
						alert('Review submitted! It will be reviewed by our team before showing on the page.');
					})
					.catch(error => console.error('Error: ', error));
			});
		</script>
</div>



<div id="existing-reviews">
	<h1 id="reviews-title">Reviews</h1>

	<script>

		const reviewContainer = document.getElementById('existing-reviews');

		fetch('/api/reviews')
			.then(response => response.json())
			.then(reviews => {
				loadReviews(reviews);
			});

		function loadReviews(data) {

			data.forEach(reviewArray => {
				var reviewBox = document.createElement('div');
				reviewBox.className = 'review-box';
				reviewBox.id = 'review-box';

				var reviewName = document.createElement('div');
				reviewName.className = 'review-name';
				reviewName.id = 'review-name';
				reviewName.textContent = reviewArray.review_username;
				reviewBox.appendChild(reviewName);

				var reviewDescription = document.createElement('div');
				reviewDescription.className = 'review-description';
				reviewDescription.id = 'review-description';
				reviewDescription.textContent = reviewArray.review_description;
				reviewBox.appendChild(reviewDescription);

				//fd

				const star = 'â˜…';

				var ratingFlex = document.createElement('div');
				ratingFlex.className = 'ratingFlex';
				ratingFlex.id = 'ratingFlex';

                const reviewID = document.createElement('div');
				reviewID.className = 'reviewID';
				reviewID.textContent = reviewArray.review_id;
				ratingFlex.appendChild(reviewID);
				//performance-rating
				var performanceText = document.createElement('h5');
				performanceText.id = 'performance-rating-text';
				performanceText.textContent = 'Performance Rating:'
				ratingFlex.appendChild(performanceText);
				var performanceValue = document.createElement('div');
				performanceValue.id = 'performance-rating-value';
				performanceValue.className = 'star-rating';
				performanceValue.textContent = star.repeat(reviewArray.review_performance_rating);
				ratingFlex.appendChild(performanceValue);

				//customer-service-rating
				var customerServiceText = document.createElement('h5');
				customerServiceText.id = 'customer-service-rating-text';
				customerServiceText.textContent = 'Customer Service Rating:'
				ratingFlex.appendChild(customerServiceText);
				var customerServiceValue = document.createElement('div');
				customerServiceValue.id = 'customer-service-rating-value';
				customerServiceValue.className = 'star-rating';
				customerServiceValue.textContent = star.repeat(reviewArray.review_customer_service_rating);
				ratingFlex.appendChild(customerServiceValue);

				//support-service-rating
                var supportServiceText = document.createElement('h5');
                supportServiceText.id = 'support-service-rating-text';
                supportServiceText.textContent = 'Support Service Rating:'
                ratingFlex.appendChild(supportServiceText);
                var supportServiceValue = document.createElement('div');
                supportServiceValue.id = 'support-service-rating-value';
                supportServiceValue.className = 'star-rating';
                supportServiceValue.textContent = star.repeat(reviewArray.review_support_service_rating);
                ratingFlex.appendChild(supportServiceValue);

				//after-sale-support-rating
                var afterSaleSupportText = document.createElement('h5');
                afterSaleSupportText.id = 'after-sale-support-rating-text';
                afterSaleSupportText.textContent = 'After Sale Support Rating:'
                ratingFlex.appendChild(afterSaleSupportText);
                var afterSaleSupportValue = document.createElement('div');
                afterSaleSupportValue.id = 'after-sale-support-rating';
                afterSaleSupportValue.className = 'star-rating';
                afterSaleSupportValue.textContent = star.repeat(reviewArray.review_after_sale_support_service_rating);
                ratingFlex.appendChild(afterSaleSupportValue);

				reviewBox.appendChild(ratingFlex);

				var reviewDate = document.createElement('div');
				reviewDate.className = 'review-date';
				reviewDate.id = 'review-date';
				reviewDate.textContent = reviewArray.review_date;
				reviewBox.appendChild(reviewDate);

				reviewContainer.appendChild(reviewBox);

			});

            functionCreateReplyBox();



		}

        function functionCreateReplyBox(){
            const reviews = document.getElementsByClassName('review-box');
            Array.from(reviews).forEach(review => {

                var replyBox = document.createElement('div');
				replyBox.className = 'reply-box';

                var replyButton = document.createElement('div');
                replyButton.className = 'reply-button';
                replyButton.textContent = 'Reply';

                var usernameInput = document.createElement('textarea');
                usernameInput.type = 'text';
				usernameInput.placeholder = 'Your Username';
				usernameInput.id = 'reply-name';
				usernameInput.rows = 1;
                var replyInput = document.createElement('textarea');
				replyInput.placeholder = 'Your Reply';
				

                var submitButton = document.createElement('button');
				submitButton.textContent = 'Submit Reply';
				submitButton.type = 'submit';

                replyBox.appendChild(usernameInput);
                replyBox.appendChild(replyInput);
				replyBox.appendChild(submitButton);

                review.appendChild(replyButton);
				review.appendChild(replyBox);

                replyButton.addEventListener('click', function () {
                    replyBox.style.display = replyBox.style.display === 'block' ? 'none' : 'block';
                });
            });
		}


	</script>

</div>



</body>
</html>
